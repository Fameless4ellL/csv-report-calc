# csv_median_calculator

Консольное приложение для расчёта медианы цен из CSV-файлов с потоковыми данными биржевых торгов.

## Описание

Приложение читает CSV-файлы биржевых данных из указанной директории, вычисляет медиану цен инкрементально (по мере поступления данных) и сохраняет в выходной файл только те моменты, когда медиана изменилась.

**Принцип работы:** каждое новое значение цены добавляется в расчёт, медиана пересчитывается с учётом всех предыдущих значений. Запись в файл происходит только при изменении медианы.

## Требования

- CMake ≥ 3.23
- Компилятор с поддержкой C++23 (GCC 13+, Clang 17+)
- Интернет-соединение при первой сборке (для загрузки зависимостей через FetchContent)

**Зависимости (загружаются автоматически):**

- `Boost.Program_options` — парсинг аргументов командной строки
- `Boost.Accumulators` — статистические вычисления
- `toml++` — парсинг конфигурации TOML
- `spdlog` — логирование
- `Catch2` — unit-тесты

## Сборка проекта

```bash
# Конфигурация
cmake -S . -B build -DCMAKE_BUILD_TYPE=Release

# Сборка
cmake --build build --parallel

# Запуск тестов
cd build && ctest --output-on-failure
```

## Запуск приложения

```bash
# С указанием конфига
./build/csv_median_calculator -config config.toml

# Или краткая форма
./build/csv_median_calculator -cfg config.toml

# Без аргументов — ищет config.toml рядом с исполняемым файлом
./build/csv_median_calculator
```

## Формат конфигурации

```toml
[main]
# Обязательный: путь к директории с входными CSV-файлами
input = './data'

# Опциональный: путь к директории для выходных файлов
# По умолчанию: ./output
output = './results'

# Опциональный: маски имён файлов для фильтрации
# Пустой список — читать все CSV файлы
filename_mask = ['level', 'trade']
```

## Форматы входных файлов

**trade.csv** (разделитель `;`):
```
receive_ts;exchange_ts;price;quantity;side
1716810808663260;1716810808661000;68480.10000000;0.01100000;bid
```

**level.csv** (разделитель `;`):
```
receive_ts;exchange_ts;price;quantity;side;rebuild
1716810808593627;1716810808574000;68480.00000000;10.10900000;bid;1
```

## Формат выходного файла

```
receive_ts;price_median
1716810808663260;68480.10000000
1716810809314641;68480.05000000
```

## Примеры

### Базовый пример

```toml
[main]
input = './data'
output = './results'
filename_mask = ['trade']
```

```bash
./build/csv_median_calculator -config config.toml
```

Обработает только файлы с `trade` в имени, результат сохранит в `./results/median_result.csv`.

### Обработка всех файлов

```toml
[main]
input = '/var/data/market'
filename_mask = []
```

Обработает все `.csv` файлы в директории.
